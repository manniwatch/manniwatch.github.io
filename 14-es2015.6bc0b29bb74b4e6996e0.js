(window.webpackJsonp=window.webpackJsonp||[]).push([[14],{SIQ7:function(t,e,s){"use strict";s.r(e),s.d(e,"TripPassagesModule",(function(){return J}));var a=s("ofXK"),n=s("NFeN"),i=s("MutI"),r=s("3cPY"),o=s("RSro"),c=s("tyNb"),p=s("Q9rz"),l=s("2Vo4"),u=s("VRyK"),b=s("PqYM"),g=s("SxV6"),f=s("5+tZ"),O=s("lJxs"),h=s("Kqap"),d=s("vkgz"),m=s("eIep"),P=s("IzEk"),v=s("LRne"),I=s("JIr8"),_=function(t){return t[t.LOADING=1]="LOADING",t[t.LOADED=2]="LOADED",t[t.ERROR=3]="ERROR",t[t.PAUSED=4]="PAUSED",t[t.UNKNOWN=5]="UNKNOWN",t[t.NOT_FOUND=404]="NOT_FOUND",t[t.SERVER_ERROR=500]="SERVER_ERROR",t}({});class R{static convertResponse(t){return Object(O.a)(t=>({failures:0,status:_.LOADED,timestamp:Date.now(),tripId:t.tripId,tripInfo:t}))}static handleError(t){return Object(I.a)(e=>e&&e.status?Object(v.a)({failures:1,passages:void 0,status:e.status>=500&&e.status<600?_.SERVER_ERROR:e.status,timestamp:Date.now(),tripId:t}):Object(v.a)({failures:1,passages:void 0,status:_.ERROR,timestamp:Date.now(),tripId:t}))}}var M=s("fXoL"),S=s("o0su");let C=(()=>{class t{constructor(t,e,s,a){this.route=t,this.apiService=e,this.vehicleService=s,this.appRef=a,this.statusSubject=new l.a(t.snapshot.data.tripPassages),this.statusObservable=this.createStatusObservable(this.statusSubject)}createStatusObservable(t){const e=this.createRefreshPollObservable(t);return this.appRef.isStable.pipe(Object(g.a)(),Object(f.a)(()=>Object(u.a)(this.route.data.pipe(Object(O.a)(t=>t.tripPassages)),e).pipe(Object(h.a)((t,e,s)=>{if(e.failures>0){const s=Object.assign({},e);return s.failures=e.failures+t.failures,s}return e}),Object(d.a)(e=>t.next(e)))))}createRefreshPollObservable(t){return t.pipe(Object(m.a)(t=>this.createDelayedPassageRequest(t.tripId,t.status===_.LOADED?1e4:2e4)))}createDelayedPassageRequest(t,e){return Object(b.a)(e).pipe(Object(P.a)(1),Object(f.a)(()=>this.apiService.getTripPassages(t)),R.convertResponse(t),R.handleError(t))}createStopLocationObservable(){return this.route.data.pipe(Object(O.a)(t=>t.tripPassages),Object(m.a)(t=>this.vehicleService.getVehicleByTripId(t.tripId)))}}return t.\u0275fac=function(e){return new(e||t)(M.Vb(c.a),M.Vb(S.a),M.Vb(S.e),M.Vb(M.g))},t.\u0275prov=M.Gb({token:t,factory:t.\u0275fac}),t})();var D=s("FSSf"),E=s("2UN5"),j=s("oOFT"),y=s("LPPQ"),N=s("jG/O"),w=s("7xvl"),L=s("sWYD"),x=s("FKr1");const A=function(t){return["/stop",t]};let z=(()=>{class t{get departed(){return!!this.passage&&this.passage.status===j.a.DEPARTED}get stopping(){return!!this.passage&&this.passage.status===j.a.STOPPING}get passageTime(){if(this.passage){const t=this.passage.actualTime||this.passage.plannedTime;if(t){const e=Object(y.a)(t,"HH:mm",new Date),s=Object(N.a)(e,new Date);return Math.abs(s)<15?Object(w.a)(e,{addSuffix:!0}):Object(L.a)(e,"p")}}return"No departure time"}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=M.Eb({type:t,selectors:[["app-trip-passages-list-item"]],hostVars:4,hostBindings:function(t,e){2&t&&M.Cb("departed",e.departed)("stopping",e.stopping)},inputs:{passage:"passage"},decls:11,vars:6,consts:function(){return[["mat-list-item","","role","listitem",3,"routerLink"],["matListIcon","","role","figure",6,"aria-label"],["aria-label",$localize`:@@busStopIcon␟c5b9c1505998539fbe7799f39d5599f65afb24cb␟2554385076132608454:Bus stop icon`],["matLine","",1,"title",6,"aria-label"],["aria-label",$localize`:@@stopName␟cda036c397ca09cd2a0a308899f03908182f5e6b␟6695271591602705899:Stop name`],["matLine","",1,"subtitle"],["role","timer"],["role","status",1,"demo-2"]]},template:function(t,e){1&t&&(M.Pb(0,"a",0),M.Pb(1,"mat-icon",1),M.Ub(2,2),M.Ob(),M.Pb(3,"h4",3),M.Ub(4,4),M.Bc(5),M.Ob(),M.Pb(6,"p",5),M.Pb(7,"span",6),M.Bc(8),M.Pb(9,"span",7),M.Bc(10),M.Ob(),M.Ob(),M.Ob(),M.Ob()),2&t&&(M.ic("routerLink",M.nc(4,A,null==e.passage||null==e.passage.stop?null:e.passage.stop.shortName)),M.Ab(5),M.Cc(null==e.passage||null==e.passage.stop?null:e.passage.stop.name),M.Ab(3),M.Cc(e.passageTime),M.Ab(2),M.Dc("\xa0-- ",null==e.passage?null:e.passage.status,""))},directives:[i.c,c.h,n.a,i.b,x.g],styles:['mat-icon[matListIcon][_ngcontent-%COMP%]:after{content:"directions_bus"}.departed[_nghost-%COMP%]   a[_ngcontent-%COMP%], .departed   [_nghost-%COMP%]   a[_ngcontent-%COMP%]{opacity:.75!important;background-color:rgba(0,0,0,.1)}.departed[_nghost-%COMP%]   mat-icon[matListIcon][_ngcontent-%COMP%]:after, .departed   [_nghost-%COMP%]   mat-icon[matListIcon][_ngcontent-%COMP%]:after{content:"transfer_within_a_station"}.stopping[_nghost-%COMP%]   a[_ngcontent-%COMP%], .stopping   [_nghost-%COMP%]   a[_ngcontent-%COMP%]{background-color:rgba(0,255,0,.1)}.stopping[_nghost-%COMP%]   mat-icon[matListIcon][_ngcontent-%COMP%]:after, .stopping   [_nghost-%COMP%]   mat-icon[matListIcon][_ngcontent-%COMP%]:after{content:"place"}h4.title[_ngcontent-%COMP%]{font-size:16px!important;font-weight:700!important;opacity:.87}h4.title[_ngcontent-%COMP%], p.subtitle[_ngcontent-%COMP%]{font-family:Roboto,Helvetica Neue,sans-serif}p.subtitle[_ngcontent-%COMP%]{font-size:12px!important;line-height:20px;font-weight:600!important;opacity:.6}'],changeDetection:0}),t})();function T(t,e){1&t&&M.Lb(0,"app-trip-passages-list-item",4),2&t&&M.ic("passage",e.$implicit)}function k(t,e){if(1&t&&(M.Pb(0,"mat-nav-list",2),M.zc(1,T,1,1,"app-trip-passages-list-item",3),M.Ob()),2&t){const t=M.cc();M.Ab(1),M.ic("ngForOf",t.passages)}}function V(t,e){1&t&&(M.Pb(0,"h3"),M.Bc(1,"No Passages"),M.Ob())}let U=(()=>{class t{constructor(){this.passages=[]}set tripInfo(t){if(t){const e=[];return t.actual&&e.push(...t.actual),t.old&&t.old.length>0&&e.push(...t.old),e.sort((t,e)=>parseInt(t.stop_seq_num,10)-parseInt(e.stop_seq_num,10)),void(this.passages=e)}this.passages=[]}hasPassages(){return Array.isArray(this.passages)&&this.passages.length>0}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=M.Eb({type:t,selectors:[["app-trip-passages-list"]],inputs:{tripInfo:"tripInfo"},decls:3,vars:2,consts:[["role","list",4,"ngIf","ngIfElse"],["noPassagesBlock",""],["role","list"],[3,"passage",4,"ngFor","ngForOf"],[3,"passage"]],template:function(t,e){if(1&t&&(M.zc(0,k,2,1,"mat-nav-list",0),M.zc(1,V,2,0,"ng-template",null,1,M.Ac)),2&t){const t=M.qc(2);M.ic("ngIf",e.hasPassages())("ngIfElse",t)}},directives:[a.l,i.g,a.k,z],styles:["[_nghost-%COMP%]{display:block}"],changeDetection:0}),t})();function F(t,e){1&t&&(M.Pb(0,"div",5),M.Pb(1,"h4"),M.Bc(2,"not found"),M.Ob(),M.Ob())}function B(t,e){if(1&t&&(M.Nb(0),M.Pb(1,"app-header-box",1),M.Lb(2,"map",2),M.Ob(),M.zc(3,F,3,0,"div",3),M.Lb(4,"app-trip-passages-list",4),M.Mb()),2&t){const t=e.ngIf,s=M.cc();M.Ab(1),M.lc("title","",null==t?null:t.tripInfo.routeName," - ",null==t?null:t.tripInfo.directionText,""),M.Ab(1),M.ic("mapData",s.headerMapData),M.Ab(1),M.ic("ngIf",t.status==s.STATUS_OPS.NOT_FOUND),M.Ab(1),M.ic("tripInfo",t.tripInfo)}}let K=(()=>{class t{constructor(t,e){this.zone=t,this.passageService=e,this.subscriptions=[],this.STATUS_OPS=_}ngOnInit(){this.subscriptions.push(this.passageService.createStopLocationObservable().pipe(Object(p.a)(this.zone)).subscribe({next:t=>{this.headerMapData=t?{map:{center:t},stops:void 0,vehicles:[t]}:{map:{blur:!0,center:void 0}}}}))}ngOnDestroy(){this.subscriptions.forEach(t=>{t.unsubscribe()}),this.subscriptions=[]}}return t.\u0275fac=function(e){return new(e||t)(M.Kb(M.z),M.Kb(C))},t.\u0275cmp=M.Eb({type:t,selectors:[["app-trip-passages"]],features:[M.zb([C])],decls:2,vars:3,consts:[[4,"ngIf"],[3,"title"],["appOlStatic","",3,"mapData"],["class","not-found",4,"ngIf"],[3,"tripInfo"],[1,"not-found"]],template:function(t,e){1&t&&(M.zc(0,B,5,5,"ng-container",0),M.dc(1,"async")),2&t&&M.ic("ngIf",M.ec(1,1,e.passageService.statusObservable))},directives:[a.l,D.a,E.a,U],pipes:[a.b],styles:["h3.route-title[_ngcontent-%COMP%]{padding:24px}div.error-box[_ngcontent-%COMP%]{background:#f44336;padding:16px;flex:0 0 auto}div.error-box[_ngcontent-%COMP%]   span.title[_ngcontent-%COMP%]{text-transform:capitalize;font-weight:700;display:block;font-size:16px}div.error-box[_ngcontent-%COMP%]   span.text[_ngcontent-%COMP%]{font-size:12px}mat-nav-list[_ngcontent-%COMP%]{flex-grow:1}"]}),t})(),q=(()=>{class t{constructor(t){this.api=t}resolve(t,e){const s=t.params.tripId;return this.api.getTripPassages(s).pipe(R.convertResponse(s),R.handleError(s))}}return t.\u0275fac=function(e){return new(e||t)(M.Vb(S.a))},t.\u0275prov=M.Gb({token:t,factory:t.\u0275fac}),t})();const G=[{component:K,data:{openSidebar:!0},path:":tripId",resolve:{tripPassages:q}}];let H=(()=>{class t{}return t.\u0275mod=M.Ib({type:t}),t.\u0275inj=M.Hb({factory:function(e){return new(e||t)},imports:[[c.i.forChild(G)],c.i]}),t})(),J=(()=>{class t{}return t.\u0275mod=M.Ib({type:t}),t.\u0275inj=M.Hb({factory:function(e){return new(e||t)},providers:[q],imports:[[a.c,n.b,i.d,H,r.a,o.b]]}),t})()}}]);