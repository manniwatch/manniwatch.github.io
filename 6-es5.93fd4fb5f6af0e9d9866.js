function _toConsumableArray(t){return _arrayWithoutHoles(t)||_iterableToArray(t)||_unsupportedIterableToArray(t)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(t,e){if(t){if("string"==typeof t)return _arrayLikeToArray(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(t,e):void 0}}function _iterableToArray(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}function _arrayWithoutHoles(t){if(Array.isArray(t))return _arrayLikeToArray(t)}function _arrayLikeToArray(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,a=new Array(e);n<e;n++)a[n]=t[n];return a}function _templateObject2(){var t=_taggedTemplateLiteral([":@@stopName\u241fcda036c397ca09cd2a0a308899f03908182f5e6b\u241f6695271591602705899:Stop name"]);return _templateObject2=function(){return t},t}function _templateObject(){var t=_taggedTemplateLiteral([":@@busStopIcon\u241fc5b9c1505998539fbe7799f39d5599f65afb24cb\u241f2554385076132608454:Bus stop icon"]);return _templateObject=function(){return t},t}function _taggedTemplateLiteral(t,e){return e||(e=t.slice(0)),Object.freeze(Object.defineProperties(t,{raw:{value:Object.freeze(e)}}))}function _defineProperties(t,e){for(var n=0;n<e.length;n++){var a=e[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}function _createClass(t,e,n){return e&&_defineProperties(t.prototype,e),n&&_defineProperties(t,n),t}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(window.webpackJsonp=window.webpackJsonp||[]).push([[6],{"3cPY":function(t,e,n){"use strict";n.d(e,"a",(function(){return o})),n("FSSf");var a,s=n("ofXK"),r=n("NFeN"),i=n("fXoL"),o=((a=function t(){_classCallCheck(this,t)}).\u0275mod=i.Lb({type:a}),a.\u0275inj=i.Kb({factory:function(t){return new(t||a)},imports:[[s.c,r.b]]}),a)},"7z+Z":function(t,e,n){"use strict";var a;Object.defineProperty(e,"__esModule",{value:!0}),(a=e.VEHICLE_STATUS||(e.VEHICLE_STATUS={})).PREDICTED="PREDICTED",a.DEPARTED="DEPARTED",a.STOPPING="STOPPING",a.PLANNED="PLANNED"},FSSf:function(t,e,n){"use strict";n.d(e,"a",(function(){return l}));var a=n("fXoL"),s=n("ofXK"),r=n("NFeN");function i(t,e){if(1&t&&(a.Sb(0,"span",3),a.Cc(1),a.Rb()),2&t){var n=a.fc();a.mc("title",n.title),a.Cb(1),a.Dc(n.title)}}function o(t,e){if(1&t&&(a.Sb(0,"span",4),a.gc(1,"date"),a.Cc(2),a.gc(3,"date"),a.Rb()),2&t){var n=a.fc();a.mc("title",a.ic(1,2,n.lastUpdate,"full")),a.Cb(2),a.Ec("Last Update: ",a.ic(3,5,n.lastUpdate,"mediumTime"),"")}}var c=["*"],l=function(){var t=function t(){_classCallCheck(this,t),this.lastUpdate=void 0};return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=a.Hb({type:t,selectors:[["app-header-box"]],inputs:{lastUpdate:"lastUpdate",title:"title"},ngContentSelectors:c,decls:6,vars:2,consts:[[1,"title-box"],["class","title","role","heading","aria-level","2",3,"title",4,"ngIf"],["class","subtitle",3,"title",4,"ngIf"],["role","heading","aria-level","2",1,"title",3,"title"],[1,"subtitle",3,"title"]],template:function(t,e){1&t&&(a.kc(),a.jc(0),a.Sb(1,"div",0),a.Ac(2,i,2,2,"span",1),a.Ac(3,o,4,8,"span",2),a.Rb(),a.Sb(4,"mat-icon"),a.Cc(5,"location_off"),a.Rb()),2&t&&(a.Cb(2),a.lc("ngIf",void 0!==e.title),a.Cb(1),a.lc("ngIf",void 0!==e.lastUpdate))},directives:[s.l,r.a],pipes:[s.e],styles:["[_nghost-%COMP%]{position:relative;min-height:250px;max-height:300px;height:75vw;width:100%;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;overflow:none;flex:0 0}[_nghost-%COMP%] >   map{position:absolute;display:block;height:100%;width:100%}[_nghost-%COMP%] >   map   .leaflet-control-attribution{display:none}.title-box[_ngcontent-%COMP%]{position:absolute;bottom:0;left:0;right:0;z-index:800;padding:20px 20px 10px;color:#fff;text-shadow:0 0 5px #000;background-image:linear-gradient(transparent,rgba(0,0,0,.7));display:flex;flex-direction:column;align-items:stretch}.title-box[_ngcontent-%COMP%]   span.title[_ngcontent-%COMP%]{font-size:20px;font-weight:700}.title-box[_ngcontent-%COMP%]   span.subtitle[_ngcontent-%COMP%]{font-size:12px;font-weight:700}mat-icon[_ngcontent-%COMP%]{position:absolute;z-index:799;bottom:0;left:0;right:0;top:0;margin:auto;font-size:64px;width:64px;height:64px;display:none;color:#fff}.no-location[_nghost-%COMP%]     map, .no-location   [_nghost-%COMP%]     map{-webkit-filter:blur(2px) grayscale(100%) brightness(.5);filter:blur(2px) grayscale(100%) brightness(.5);transition:all 1s ease-out}.no-location[_nghost-%COMP%]   mat-icon[_ngcontent-%COMP%], .no-location   [_nghost-%COMP%]   mat-icon[_ngcontent-%COMP%]{display:block}map.no-location[_ngcontent-%COMP%]   map[_ngcontent-%COMP%]{-webkit-filter:blur(2px) grayscale(100%) brightness(.5);filter:blur(2px) grayscale(100%) brightness(.5);transition:all 1s ease-out}map.no-location[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{display:block}"],changeDetection:0}),t}()},SIQ7:function(t,e,n){"use strict";n.r(e),n.d(e,"TripPassagesModule",(function(){return $}));var a,s,r=n("ofXK"),i=n("NFeN"),o=n("MutI"),c=n("3cPY"),l=n("RSro"),p=n("tyNb"),u=n("2Vo4"),f=n("VRyK"),b=n("PqYM"),g=n("lJxs"),d=n("Kqap"),h=n("vkgz"),m=n("eIep"),O=n("IzEk"),_=n("5+tZ"),C=n("LRne"),v=n("JIr8"),y=function(t){return t[t.LOADING=1]="LOADING",t[t.LOADED=2]="LOADED",t[t.ERROR=3]="ERROR",t[t.PAUSED=4]="PAUSED",t[t.UNKNOWN=5]="UNKNOWN",t[t.NOT_FOUND=404]="NOT_FOUND",t[t.SERVER_ERROR=500]="SERVER_ERROR",t}({}),P=function(){function t(){_classCallCheck(this,t)}return _createClass(t,null,[{key:"convertResponse",value:function(t){return Object(g.a)((function(t){return{failures:0,status:y.LOADED,timestamp:Date.now(),tripId:t.tripId,tripInfo:t}}))}},{key:"handleError",value:function(t){return Object(v.a)((function(e){return e&&e.status?Object(C.a)({failures:1,passages:void 0,status:e.status>=500&&e.status<600?y.SERVER_ERROR:e.status,timestamp:Date.now(),tripId:t}):Object(C.a)({failures:1,passages:void 0,status:y.ERROR,timestamp:Date.now(),tripId:t})}))}}]),t}(),S=n("fXoL"),I=n("o0su"),R=((a=function(){function t(e,n,a){_classCallCheck(this,t),this.route=e,this.apiService=n,this.vehicleService=a,this.statusSubject=new u.a(e.snapshot.data.tripPassages),this.statusObservable=this.createStatusObservable(this.statusSubject)}return _createClass(t,[{key:"createStatusObservable",value:function(t){var e=this.createRefreshPollObservable(t);return Object(f.a)(this.route.data.pipe(Object(g.a)((function(t){return t.tripPassages}))),e).pipe(Object(d.a)((function(t,e,n){if(e.failures>0){var a=Object.assign({},e);return a.failures=e.failures+t.failures,a}return e})),Object(h.a)((function(e){return t.next(e)})))}},{key:"createRefreshPollObservable",value:function(t){var e=this;return t.pipe(Object(m.a)((function(t){return e.createDelayedPassageRequest(t.tripId,t.status===y.LOADED?1e4:2e4)})))}},{key:"createDelayedPassageRequest",value:function(t,e){var n=this;return Object(b.a)(e).pipe(Object(O.a)(1),Object(_.a)((function(){return n.apiService.getTripPassages(t)})),P.convertResponse(t),P.handleError(t))}},{key:"createStopLocationObservable",value:function(){var t=this;return this.route.data.pipe(Object(g.a)((function(t){return t.tripPassages})),Object(m.a)((function(e){return t.vehicleService.getVehicleByTripId(e.tripId)})))}}]),t}()).\u0275fac=function(t){return new(t||a)(S.Xb(p.a),S.Xb(I.a),S.Xb(I.d))},a.\u0275prov=S.Jb({token:a,factory:a.\u0275fac}),a),k=n("FSSf"),M=n("2UN5"),E=n("7z+Z"),A=n("FKr1"),x=["aria-label",$localize(_templateObject())],D=["aria-label",$localize(_templateObject2())],T=function(t){return["/stop",t]},w=((s=function(){function t(){_classCallCheck(this,t)}return _createClass(t,[{key:"departed",get:function(){return!!this.passage&&this.passage.status===E.VEHICLE_STATUS.DEPARTED}},{key:"stopping",get:function(){return!!this.passage&&this.passage.status===E.VEHICLE_STATUS.STOPPING}}]),t}()).\u0275fac=function(t){return new(t||s)},s.\u0275cmp=S.Hb({type:s,selectors:[["app-trip-passages-list-item"]],hostVars:4,hostBindings:function(t,e){2&t&&S.Eb("departed",e.departed)("stopping",e.stopping)},inputs:{passage:"passage"},decls:11,vars:6,consts:[["mat-list-item","","role","listitem",3,"routerLink"],["matListIcon","","role","figure",6,"aria-label"],["matLine","",6,"aria-label"],["matLine",""],["role","timer"],["role","status",1,"demo-2"]],template:function(t,e){1&t&&(S.Sb(0,"a",0),S.Sb(1,"mat-icon",1),S.Wb(2,x),S.Rb(),S.Sb(3,"h3",2),S.Wb(4,D),S.Cc(5),S.Rb(),S.Sb(6,"p",3),S.Sb(7,"span",4),S.Cc(8),S.Rb(),S.Sb(9,"span",5),S.Cc(10),S.Rb(),S.Rb(),S.Rb()),2&t&&(S.lc("routerLink",S.qc(4,T,null==e.passage||null==e.passage.stop?null:e.passage.stop.shortName)),S.Cb(5),S.Dc(null==e.passage||null==e.passage.stop?null:e.passage.stop.name),S.Cb(3),S.Dc(null==e.passage?null:e.passage.actualTime),S.Cb(2),S.Ec("-- ",null==e.passage?null:e.passage.status,""))},directives:[o.c,p.h,i.a,o.b,A.f],styles:['mat-icon[matListIcon][_ngcontent-%COMP%]:after{content:"directions_bus"}.departed[_nghost-%COMP%]   a[_ngcontent-%COMP%], .departed   [_nghost-%COMP%]   a[_ngcontent-%COMP%]{opacity:.75!important;background-color:rgba(0,0,0,.1)}.departed[_nghost-%COMP%]   mat-icon[matListIcon][_ngcontent-%COMP%]:after, .departed   [_nghost-%COMP%]   mat-icon[matListIcon][_ngcontent-%COMP%]:after{content:"transfer_within_a_station"}.stopping[_nghost-%COMP%]   a[_ngcontent-%COMP%], .stopping   [_nghost-%COMP%]   a[_ngcontent-%COMP%]{background-color:rgba(0,255,0,.1)}.stopping[_nghost-%COMP%]   mat-icon[matListIcon][_ngcontent-%COMP%]:after, .stopping   [_nghost-%COMP%]   mat-icon[matListIcon][_ngcontent-%COMP%]:after{content:"departure_board"}'],changeDetection:0}),s);function L(t,e){1&t&&S.Ob(0,"app-trip-passages-list-item",4),2&t&&S.lc("passage",e.$implicit)}function j(t,e){if(1&t&&(S.Sb(0,"mat-nav-list",2),S.Ac(1,L,1,1,"app-trip-passages-list-item",3),S.Rb()),2&t){var n=S.fc();S.Cb(1),S.lc("ngForOf",n.passages)}}function N(t,e){1&t&&(S.Sb(0,"h3"),S.Cc(1,"No Passages"),S.Rb())}var U,z=((U=function(){function t(){_classCallCheck(this,t),this.passages=[]}return _createClass(t,[{key:"hasPassages",value:function(){return Array.isArray(this.passages)&&this.passages.length>0}},{key:"tripInfo",set:function(t){if(t){var e=[];return t.actual&&e.push.apply(e,_toConsumableArray(t.actual)),t.old&&t.old.length>0&&e.push.apply(e,_toConsumableArray(t.old)),e.sort((function(t,e){return parseInt(t.stop_seq_num,10)-parseInt(e.stop_seq_num,10)})),void(this.passages=e)}this.passages=[]}}]),t}()).\u0275fac=function(t){return new(t||U)},U.\u0275cmp=S.Hb({type:U,selectors:[["app-trip-passages-list"]],inputs:{tripInfo:"tripInfo"},decls:3,vars:2,consts:[["role","list",4,"ngIf","ngIfElse"],["noPassagesBlock",""],["role","list"],[3,"passage",4,"ngFor","ngForOf"],[3,"passage"]],template:function(t,e){if(1&t&&(S.Ac(0,j,2,1,"mat-nav-list",0),S.Ac(1,N,2,0,"ng-template",null,1,S.Bc)),2&t){var n=S.tc(2);S.lc("ngIf",e.hasPassages())("ngIfElse",n)}},directives:[r.l,o.f,r.k,w],styles:["[_nghost-%COMP%]{display:block}"],changeDetection:0}),U);function F(t,e){1&t&&(S.Sb(0,"div",5),S.Sb(1,"h4"),S.Cc(2,"not found"),S.Rb(),S.Rb())}function K(t,e){if(1&t&&(S.Qb(0),S.Sb(1,"app-header-box",1),S.Ob(2,"map",2),S.Rb(),S.Ac(3,F,3,0,"div",3),S.Ob(4,"app-trip-passages-list",4),S.Pb()),2&t){var n=e.ngIf,a=S.fc();S.Cb(1),S.oc("title","",null==n?null:n.tripInfo.routeName," - ",null==n?null:n.tripInfo.directionText,""),S.Cb(1),S.lc("mapData",a.headerMapData),S.Cb(1),S.lc("ngIf",n.status==a.STATUS_OPS.NOT_FOUND),S.Cb(1),S.lc("tripInfo",n.tripInfo)}}var V,H,X,q,B=((H=function(){function t(e){_classCallCheck(this,t),this.passageService=e,this.subscriptions=[],this.STATUS_OPS=y}return _createClass(t,[{key:"ngOnInit",value:function(){var t=this;this.subscriptions.push(this.passageService.createStopLocationObservable().subscribe({next:function(e){t.headerMapData=e?{map:{center:e},stops:void 0,vehicles:[e]}:{map:{blur:!0,center:void 0}}}}))}},{key:"ngOnDestroy",value:function(){this.subscriptions.forEach((function(t){t.unsubscribe()})),this.subscriptions=[]}}]),t}()).\u0275fac=function(t){return new(t||H)(S.Nb(R))},H.\u0275cmp=S.Hb({type:H,selectors:[["app-trip-passages"]],features:[S.Bb([R])],decls:2,vars:3,consts:[[4,"ngIf"],[3,"title"],["appOlStatic","",3,"mapData"],["class","not-found",4,"ngIf"],[3,"tripInfo"],[1,"not-found"]],template:function(t,e){1&t&&(S.Ac(0,K,5,5,"ng-container",0),S.gc(1,"async")),2&t&&S.lc("ngIf",S.hc(1,1,e.passageService.statusObservable))},directives:[r.l,k.a,M.a,z],pipes:[r.b],styles:["h3.route-title[_ngcontent-%COMP%]{padding:24px}div.error-box[_ngcontent-%COMP%]{background:#f44336;padding:16px;flex:0 0 auto}div.error-box[_ngcontent-%COMP%]   span.title[_ngcontent-%COMP%]{text-transform:capitalize;font-weight:700;display:block;font-size:16px}div.error-box[_ngcontent-%COMP%]   span.text[_ngcontent-%COMP%]{font-size:12px}mat-nav-list[_ngcontent-%COMP%]{flex-grow:1}"]}),H),J=((V=function(){function t(e){_classCallCheck(this,t),this.api=e}return _createClass(t,[{key:"resolve",value:function(t,e){var n=t.params.tripId;return this.api.getTripPassages(n).pipe(P.convertResponse(n),P.handleError(n))}}]),t}()).\u0275fac=function(t){return new(t||V)(S.Xb(I.a))},V.\u0275prov=S.Jb({token:V,factory:V.\u0275fac}),V),W=[{component:B,data:{openSidebar:!0},path:":tripId",resolve:{tripPassages:J}}],G=((q=function t(){_classCallCheck(this,t)}).\u0275mod=S.Lb({type:q}),q.\u0275inj=S.Kb({factory:function(t){return new(t||q)},imports:[[p.i.forChild(W)],p.i]}),q),$=((X=function t(){_classCallCheck(this,t)}).\u0275mod=S.Lb({type:X}),X.\u0275inj=S.Kb({factory:function(t){return new(t||X)},providers:[J],imports:[[r.c,i.b,o.d,G,c.a,l.b]]}),X)}}]);