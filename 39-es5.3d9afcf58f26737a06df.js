!function(){var t,e;function n(t){return function(t){if(Array.isArray(t))return a(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return a(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return a(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function a(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,a=new Array(e);n<e;n++)a[n]=t[n];return a}function s(t,e){return e||(e=t.slice(0)),Object.freeze(Object.defineProperties(t,{raw:{value:Object.freeze(e)}}))}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){for(var n=0;n<e.length;n++){var a=e[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}function o(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),t}(self.webpackChunk_manniwatch_client_ng=self.webpackChunk_manniwatch_client_ng||[]).push([[39],{7039:function(a,i,u){"use strict";u.r(i),u.d(i,{TripPassagesModule:function(){return tt}});var c=u(61116),p=u(77307),f=u(85078),l=u(13096),g=u(85496),h=u(32860),d=u(35366),m=u(82391),v=u(97425),b=u(15446),O=u(49234),_=u(18606),y=u(47228),P=u(91681),I=u(38193),S=u(90343),R=u(14324),M=u(69056),w=u(32041),A=u(51816),C=function(t){return t[t.LOADING=1]="LOADING",t[t.LOADED=2]="LOADED",t[t.ERROR=3]="ERROR",t[t.PAUSED=4]="PAUSED",t[t.UNKNOWN=5]="UNKNOWN",t[t.NOT_FOUND=404]="NOT_FOUND",t[t.SERVER_ERROR=500]="SERVER_ERROR",t}({}),x=function(){function t(){r(this,t)}return o(t,null,[{key:"convertResponse",value:function(t){return(0,P.U)(function(t){return{failures:0,status:C.LOADED,timestamp:Date.now(),tripId:t.tripId,tripInfo:t}})}},{key:"handleError",value:function(t){return(0,A.K)(function(e){return(0,w.of)(e&&e.status?{failures:1,passages:void 0,status:e.status>=500&&e.status<600?C.SERVER_ERROR:e.status,timestamp:Date.now(),tripId:t}:{failures:1,passages:void 0,status:C.ERROR,timestamp:Date.now(),tripId:t})})}}]),t}(),k=u(10682),D=function(){var t=function(){function t(e,n,a,s){r(this,t),this.route=e,this.apiService=n,this.vehicleService=a,this.appRef=s,this.statusSubject=new v.X(e.snapshot.data.tripPassages),this.statusObservable=this.createStatusObservable(this.statusSubject)}return o(t,[{key:"createStatusObservable",value:function(t){var e=this,n=this.createRefreshPollObservable(t);return this.appRef.isStable.pipe((0,_.P)(),(0,y.z)(function(){return(0,b.T)(e.route.data.pipe((0,P.U)(function(t){return t.tripPassages})),n).pipe((0,I.R)(function(t,e,n){if(e.failures>0){var a=Object.assign({},e);return a.failures=e.failures+t.failures,a}return e}),(0,S.b)(function(e){return t.next(e)}))}))}},{key:"createRefreshPollObservable",value:function(t){var e=this;return t.pipe((0,R.w)(function(t){return e.createDelayedPassageRequest(t.tripId,t.status===C.LOADED?1e4:2e4)}))}},{key:"createDelayedPassageRequest",value:function(t,e){var n=this;return(0,O.H)(e).pipe((0,M.q)(1),(0,y.z)(function(){return n.apiService.getTripPassages(t)}),x.convertResponse(t),x.handleError(t))}},{key:"createStopLocationObservable",value:function(){var t=this;return this.route.data.pipe((0,P.U)(function(t){return t.tripPassages}),(0,R.w)(function(e){return t.vehicleService.getVehicleByTripId(e.tripId)}))}}]),t}();return t.\u0275fac=function(e){return new(e||t)(d.LFG(h.gz),d.LFG(k.sM),d.LFG(k.fi),d.LFG(d.z2F))},t.\u0275prov=d.Yz7({token:t,factory:t.\u0275fac}),t}(),T=u(45567),Z=u(98139),E=u(70853),N=u(57554),L=u(93779),U=u(10220),z=u(66705),q=u(87064),j=function(t){return["/stop",t]},F=function(){var n=function(){function t(){r(this,t)}return o(t,[{key:"departed",get:function(){return!!this.passage&&this.passage.status===E.F.DEPARTED}},{key:"stopping",get:function(){return!!this.passage&&this.passage.status===E.F.STOPPING}},{key:"passageTime",get:function(){if(this.passage){var t=this.passage.actualTime||this.passage.plannedTime;if(t){var e=(0,N.Z)(t,"HH:mm",new Date),n=(0,L.Z)(e,new Date);return Math.abs(n)<15?(0,U.Z)(e,{addSuffix:!0}):(0,z.Z)(e,"p")}}return"No departure time"}}]),t}();return n.\u0275fac=function(t){return new(t||n)},n.\u0275cmp=d.Xpm({type:n,selectors:[["app-trip-passages-list-item"]],hostVars:4,hostBindings:function(t,e){2&t&&d.ekj("departed",e.departed)("stopping",e.stopping)},inputs:{passage:"passage"},decls:9,vars:6,consts:function(){return[["mat-list-item","","role","listitem",3,"routerLink"],["matListIcon","","role","figure","aria-label",$localize(t||(t=s([":@@busStopIcon\u241fc5b9c1505998539fbe7799f39d5599f65afb24cb\u241f2554385076132608454:Bus stop icon"])))],["matLine","","aria-label",$localize(e||(e=s([":@@stopName\u241fcda036c397ca09cd2a0a308899f03908182f5e6b\u241f6695271591602705899:Stop name"]))),1,"title"],["matLine","",1,"subtitle"],["role","timer"],["role","status",1,"demo-2"]]},template:function(t,e){1&t&&(d.TgZ(0,"a",0),d._UZ(1,"mat-icon",1),d.TgZ(2,"h4",2),d._uU(3),d.qZA(),d.TgZ(4,"p",3),d.TgZ(5,"span",4),d._uU(6),d.TgZ(7,"span",5),d._uU(8),d.qZA(),d.qZA(),d.qZA(),d.qZA()),2&t&&(d.Q6J("routerLink",d.VKq(4,j,null==e.passage||null==e.passage.stop?null:e.passage.stop.shortName)),d.xp6(3),d.Oqu(null==e.passage||null==e.passage.stop?null:e.passage.stop.name),d.xp6(3),d.Oqu(e.passageTime),d.xp6(2),d.hij("\xa0-- ",null==e.passage?null:e.passage.status,""))},directives:[f.Tg,h.yS,p.Hw,f.Nh,q.X2],styles:['mat-icon[matListIcon][_ngcontent-%COMP%]:after{content:"directions_bus"}.departed[_nghost-%COMP%]   a[_ngcontent-%COMP%], .departed   [_nghost-%COMP%]   a[_ngcontent-%COMP%]{opacity:.75!important;background-color:rgba(0,0,0,.1)}.departed[_nghost-%COMP%]   mat-icon[matListIcon][_ngcontent-%COMP%]:after, .departed   [_nghost-%COMP%]   mat-icon[matListIcon][_ngcontent-%COMP%]:after{content:"transfer_within_a_station"}.stopping[_nghost-%COMP%]   a[_ngcontent-%COMP%], .stopping   [_nghost-%COMP%]   a[_ngcontent-%COMP%]{background-color:rgba(0,255,0,.1)}.stopping[_nghost-%COMP%]   mat-icon[matListIcon][_ngcontent-%COMP%]:after, .stopping   [_nghost-%COMP%]   mat-icon[matListIcon][_ngcontent-%COMP%]:after{content:"place"}h4.title[_ngcontent-%COMP%]{font-size:16px!important;font-weight:700!important;opacity:.87}h4.title[_ngcontent-%COMP%], p.subtitle[_ngcontent-%COMP%]{font-family:Roboto,Helvetica Neue,sans-serif}p.subtitle[_ngcontent-%COMP%]{font-size:12px!important;line-height:20px;font-weight:600!important;opacity:.6}'],changeDetection:0}),n}();function B(t,e){1&t&&d._UZ(0,"app-trip-passages-list-item",4),2&t&&d.Q6J("passage",e.$implicit)}function J(t,e){if(1&t&&(d.TgZ(0,"mat-nav-list",2),d.YNc(1,B,1,1,"app-trip-passages-list-item",3),d.qZA()),2&t){var n=d.oxw();d.xp6(1),d.Q6J("ngForOf",n.passages)}}function Y(t,e){1&t&&(d.TgZ(0,"h3"),d._uU(1,"No Passages"),d.qZA())}var Q=function(){var t=function(){function t(){r(this,t),this.passages=[]}return o(t,[{key:"tripInfo",set:function(t){if(t){var e=[];return t.actual&&e.push.apply(e,n(t.actual)),t.old&&t.old.length>0&&e.push.apply(e,n(t.old)),e.sort(function(t,e){return parseInt(t.stop_seq_num,10)-parseInt(e.stop_seq_num,10)}),void(this.passages=e)}this.passages=[]}},{key:"hasPassages",value:function(){return Array.isArray(this.passages)&&this.passages.length>0}}]),t}();return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=d.Xpm({type:t,selectors:[["app-trip-passages-list"]],inputs:{tripInfo:"tripInfo"},decls:3,vars:2,consts:[["role","list",4,"ngIf","ngIfElse"],["noPassagesBlock",""],["role","list"],[3,"passage",4,"ngFor","ngForOf"],[3,"passage"]],template:function(t,e){if(1&t&&(d.YNc(0,J,2,1,"mat-nav-list",0),d.YNc(1,Y,2,0,"ng-template",null,1,d.W1O)),2&t){var n=d.MAs(2);d.Q6J("ngIf",e.hasPassages())("ngIfElse",n)}},directives:[c.O5,f.Hk,c.sg,F],styles:["[_nghost-%COMP%]{display:block}"],changeDetection:0}),t}();function G(t,e){1&t&&(d.TgZ(0,"div",5),d.TgZ(1,"h4"),d._uU(2,"not found"),d.qZA(),d.qZA())}function H(t,e){if(1&t&&(d.ynx(0),d.TgZ(1,"app-header-box",1),d._UZ(2,"map",2),d.qZA(),d.YNc(3,G,3,0,"div",3),d._UZ(4,"app-trip-passages-list",4),d.BQk()),2&t){var n=e.ngIf,a=d.oxw();d.xp6(1),d.hYB("title","",null==n?null:n.tripInfo.routeName," - ",null==n?null:n.tripInfo.directionText,""),d.xp6(1),d.Q6J("mapData",a.headerMapData),d.xp6(1),d.Q6J("ngIf",n.status==a.STATUS_OPS.NOT_FOUND),d.xp6(1),d.Q6J("tripInfo",n.tripInfo)}}var V,X=function(){var t=function(){function t(e,n){r(this,t),this.zone=e,this.passageService=n,this.subscriptions=[],this.STATUS_OPS=C}return o(t,[{key:"ngOnInit",value:function(){var t,e=this;this.subscriptions.push(this.passageService.createStopLocationObservable().pipe((t=this.zone,function(e){return new m.y(function(n){return e.subscribe({next:function(e){d.R0b.isInAngularZone()?n.next(e):t.run(function(){n.next(e)})},error:function(t){n.error(t)},complete:function(){n.complete()}})})})).subscribe({next:function(t){e.headerMapData=t?{map:{center:t},stops:void 0,vehicles:[t]}:{map:{blur:!0,center:void 0}}}}))}},{key:"ngOnDestroy",value:function(){this.subscriptions.forEach(function(t){t.unsubscribe()}),this.subscriptions=[]}}]),t}();return t.\u0275fac=function(e){return new(e||t)(d.Y36(d.R0b),d.Y36(D))},t.\u0275cmp=d.Xpm({type:t,selectors:[["app-trip-passages"]],features:[d._Bn([D])],decls:2,vars:3,consts:[[4,"ngIf"],[3,"title"],["appOlStatic","",3,"mapData"],["class","not-found",4,"ngIf"],[3,"tripInfo"],[1,"not-found"]],template:function(t,e){1&t&&(d.YNc(0,H,5,5,"ng-container",0),d.ALo(1,"async")),2&t&&d.Q6J("ngIf",d.lcZ(1,1,e.passageService.statusObservable))},directives:[c.O5,T.c,Z.C,Q],pipes:[c.Ov],styles:["h3.route-title[_ngcontent-%COMP%]{padding:24px}div.error-box[_ngcontent-%COMP%]{background:#f44336;padding:16px;flex:0 0 auto}div.error-box[_ngcontent-%COMP%]   span.title[_ngcontent-%COMP%]{text-transform:capitalize;font-weight:700;display:block;font-size:16px}div.error-box[_ngcontent-%COMP%]   span.text[_ngcontent-%COMP%]{font-size:12px}mat-nav-list[_ngcontent-%COMP%]{flex-grow:1}"]}),t}(),K=function(){var t=function(){function t(e){r(this,t),this.api=e}return o(t,[{key:"resolve",value:function(t,e){var n=t.params.tripId;return this.api.getTripPassages(n).pipe(x.convertResponse(n),x.handleError(n))}}]),t}();return t.\u0275fac=function(e){return new(e||t)(d.LFG(k.sM))},t.\u0275prov=d.Yz7({token:t,factory:t.\u0275fac}),t}(),$=[{component:X,data:{openSidebar:!0},path:":tripId",resolve:{tripPassages:K}}],W=function(){var t=function t(){r(this,t)};return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=d.oAB({type:t}),t.\u0275inj=d.cJS({imports:[[h.Bz.forChild($)],h.Bz]}),t}(),tt=((V=function t(){r(this,t)}).\u0275fac=function(t){return new(t||V)},V.\u0275mod=d.oAB({type:V}),V.\u0275inj=d.cJS({providers:[K],imports:[[c.ez,p.Ps,f.ie,W,l.D,g.qe]]}),V)}}])}();