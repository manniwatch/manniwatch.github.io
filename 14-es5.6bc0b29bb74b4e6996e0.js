!function(){function t(t){return function(t){if(Array.isArray(t))return e(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||function(t,n){if(!t)return;if("string"==typeof t)return e(t,n);var a=Object.prototype.toString.call(t).slice(8,-1);"Object"===a&&t.constructor&&(a=t.constructor.name);if("Map"===a||"Set"===a)return Array.from(t);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return e(t,n)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function e(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,a=new Array(e);n<e;n++)a[n]=t[n];return a}function n(){var t=s([":@@stopName\u241fcda036c397ca09cd2a0a308899f03908182f5e6b\u241f6695271591602705899:Stop name"]);return n=function(){return t},t}function a(){var t=s([":@@busStopIcon\u241fc5b9c1505998539fbe7799f39d5599f65afb24cb\u241f2554385076132608454:Bus stop icon"]);return a=function(){return t},t}function s(t,e){return e||(e=t.slice(0)),Object.freeze(Object.defineProperties(t,{raw:{value:Object.freeze(e)}}))}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){for(var n=0;n<e.length;n++){var a=e[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}function o(t,e,n){return e&&r(t.prototype,e),n&&r(t,n),t}(window.webpackJsonp=window.webpackJsonp||[]).push([[14],{SIQ7:function(e,s,r){"use strict";r.r(s),r.d(s,"TripPassagesModule",(function(){return it}));var c,p,u=r("ofXK"),f=r("NFeN"),l=r("MutI"),b=r("3cPY"),g=r("RSro"),O=r("tyNb"),h=r("Q9rz"),d=r("2Vo4"),m=r("VRyK"),v=r("PqYM"),P=r("SxV6"),y=r("5+tZ"),I=r("lJxs"),_=r("Kqap"),S=r("vkgz"),R=r("eIep"),M=r("IzEk"),j=r("LRne"),C=r("JIr8"),D=function(t){return t[t.LOADING=1]="LOADING",t[t.LOADED=2]="LOADED",t[t.ERROR=3]="ERROR",t[t.PAUSED=4]="PAUSED",t[t.UNKNOWN=5]="UNKNOWN",t[t.NOT_FOUND=404]="NOT_FOUND",t[t.SERVER_ERROR=500]="SERVER_ERROR",t}({}),E=function(){function t(){i(this,t)}return o(t,null,[{key:"convertResponse",value:function(t){return Object(I.a)((function(t){return{failures:0,status:D.LOADED,timestamp:Date.now(),tripId:t.tripId,tripInfo:t}}))}},{key:"handleError",value:function(t){return Object(C.a)((function(e){return e&&e.status?Object(j.a)({failures:1,passages:void 0,status:e.status>=500&&e.status<600?D.SERVER_ERROR:e.status,timestamp:Date.now(),tripId:t}):Object(j.a)({failures:1,passages:void 0,status:D.ERROR,timestamp:Date.now(),tripId:t})}))}}]),t}(),w=r("fXoL"),k=r("o0su"),A=((c=function(){function t(e,n,a,s){i(this,t),this.route=e,this.apiService=n,this.vehicleService=a,this.appRef=s,this.statusSubject=new d.a(e.snapshot.data.tripPassages),this.statusObservable=this.createStatusObservable(this.statusSubject)}return o(t,[{key:"createStatusObservable",value:function(t){var e=this,n=this.createRefreshPollObservable(t);return this.appRef.isStable.pipe(Object(P.a)(),Object(y.a)((function(){return Object(m.a)(e.route.data.pipe(Object(I.a)((function(t){return t.tripPassages}))),n).pipe(Object(_.a)((function(t,e,n){if(e.failures>0){var a=Object.assign({},e);return a.failures=e.failures+t.failures,a}return e})),Object(S.a)((function(e){return t.next(e)})))})))}},{key:"createRefreshPollObservable",value:function(t){var e=this;return t.pipe(Object(R.a)((function(t){return e.createDelayedPassageRequest(t.tripId,t.status===D.LOADED?1e4:2e4)})))}},{key:"createDelayedPassageRequest",value:function(t,e){var n=this;return Object(v.a)(e).pipe(Object(M.a)(1),Object(y.a)((function(){return n.apiService.getTripPassages(t)})),E.convertResponse(t),E.handleError(t))}},{key:"createStopLocationObservable",value:function(){var t=this;return this.route.data.pipe(Object(I.a)((function(t){return t.tripPassages})),Object(R.a)((function(e){return t.vehicleService.getVehicleByTripId(e.tripId)})))}}]),t}()).\u0275fac=function(t){return new(t||c)(w.Vb(O.a),w.Vb(k.a),w.Vb(k.e),w.Vb(w.g))},c.\u0275prov=w.Gb({token:c,factory:c.\u0275fac}),c),N=r("FSSf"),L=r("2UN5"),x=r("oOFT"),z=r("LPPQ"),T=r("jG/O"),U=r("7xvl"),V=r("sWYD"),F=r("FKr1"),B=function(t){return["/stop",t]},K=((p=function(){function t(){i(this,t)}return o(t,[{key:"departed",get:function(){return!!this.passage&&this.passage.status===x.a.DEPARTED}},{key:"stopping",get:function(){return!!this.passage&&this.passage.status===x.a.STOPPING}},{key:"passageTime",get:function(){if(this.passage){var t=this.passage.actualTime||this.passage.plannedTime;if(t){var e=Object(z.a)(t,"HH:mm",new Date),n=Object(T.a)(e,new Date);return Math.abs(n)<15?Object(U.a)(e,{addSuffix:!0}):Object(V.a)(e,"p")}}return"No departure time"}}]),t}()).\u0275fac=function(t){return new(t||p)},p.\u0275cmp=w.Eb({type:p,selectors:[["app-trip-passages-list-item"]],hostVars:4,hostBindings:function(t,e){2&t&&w.Cb("departed",e.departed)("stopping",e.stopping)},inputs:{passage:"passage"},decls:11,vars:6,consts:function(){return[["mat-list-item","","role","listitem",3,"routerLink"],["matListIcon","","role","figure",6,"aria-label"],["aria-label",$localize(a())],["matLine","",1,"title",6,"aria-label"],["aria-label",$localize(n())],["matLine","",1,"subtitle"],["role","timer"],["role","status",1,"demo-2"]]},template:function(t,e){1&t&&(w.Pb(0,"a",0),w.Pb(1,"mat-icon",1),w.Ub(2,2),w.Ob(),w.Pb(3,"h4",3),w.Ub(4,4),w.Bc(5),w.Ob(),w.Pb(6,"p",5),w.Pb(7,"span",6),w.Bc(8),w.Pb(9,"span",7),w.Bc(10),w.Ob(),w.Ob(),w.Ob(),w.Ob()),2&t&&(w.ic("routerLink",w.nc(4,B,null==e.passage||null==e.passage.stop?null:e.passage.stop.shortName)),w.Ab(5),w.Cc(null==e.passage||null==e.passage.stop?null:e.passage.stop.name),w.Ab(3),w.Cc(e.passageTime),w.Ab(2),w.Dc("\xa0-- ",null==e.passage?null:e.passage.status,""))},directives:[l.c,O.h,f.a,l.b,F.g],styles:['mat-icon[matListIcon][_ngcontent-%COMP%]:after{content:"directions_bus"}.departed[_nghost-%COMP%]   a[_ngcontent-%COMP%], .departed   [_nghost-%COMP%]   a[_ngcontent-%COMP%]{opacity:.75!important;background-color:rgba(0,0,0,.1)}.departed[_nghost-%COMP%]   mat-icon[matListIcon][_ngcontent-%COMP%]:after, .departed   [_nghost-%COMP%]   mat-icon[matListIcon][_ngcontent-%COMP%]:after{content:"transfer_within_a_station"}.stopping[_nghost-%COMP%]   a[_ngcontent-%COMP%], .stopping   [_nghost-%COMP%]   a[_ngcontent-%COMP%]{background-color:rgba(0,255,0,.1)}.stopping[_nghost-%COMP%]   mat-icon[matListIcon][_ngcontent-%COMP%]:after, .stopping   [_nghost-%COMP%]   mat-icon[matListIcon][_ngcontent-%COMP%]:after{content:"place"}h4.title[_ngcontent-%COMP%]{font-size:16px!important;font-weight:700!important;opacity:.87}h4.title[_ngcontent-%COMP%], p.subtitle[_ngcontent-%COMP%]{font-family:Roboto,Helvetica Neue,sans-serif}p.subtitle[_ngcontent-%COMP%]{font-size:12px!important;line-height:20px;font-weight:600!important;opacity:.6}'],changeDetection:0}),p);function q(t,e){1&t&&w.Lb(0,"app-trip-passages-list-item",4),2&t&&w.ic("passage",e.$implicit)}function G(t,e){if(1&t&&(w.Pb(0,"mat-nav-list",2),w.zc(1,q,1,1,"app-trip-passages-list-item",3),w.Ob()),2&t){var n=w.cc();w.Ab(1),w.ic("ngForOf",n.passages)}}function H(t,e){1&t&&(w.Pb(0,"h3"),w.Bc(1,"No Passages"),w.Ob())}var J,$=((J=function(){function e(){i(this,e),this.passages=[]}return o(e,[{key:"hasPassages",value:function(){return Array.isArray(this.passages)&&this.passages.length>0}},{key:"tripInfo",set:function(e){if(e){var n=[];return e.actual&&n.push.apply(n,t(e.actual)),e.old&&e.old.length>0&&n.push.apply(n,t(e.old)),n.sort((function(t,e){return parseInt(t.stop_seq_num,10)-parseInt(e.stop_seq_num,10)})),void(this.passages=n)}this.passages=[]}}]),e}()).\u0275fac=function(t){return new(t||J)},J.\u0275cmp=w.Eb({type:J,selectors:[["app-trip-passages-list"]],inputs:{tripInfo:"tripInfo"},decls:3,vars:2,consts:[["role","list",4,"ngIf","ngIfElse"],["noPassagesBlock",""],["role","list"],[3,"passage",4,"ngFor","ngForOf"],[3,"passage"]],template:function(t,e){if(1&t&&(w.zc(0,G,2,1,"mat-nav-list",0),w.zc(1,H,2,0,"ng-template",null,1,w.Ac)),2&t){var n=w.qc(2);w.ic("ngIf",e.hasPassages())("ngIfElse",n)}},directives:[u.l,l.g,u.k,K],styles:["[_nghost-%COMP%]{display:block}"],changeDetection:0}),J);function Q(t,e){1&t&&(w.Pb(0,"div",5),w.Pb(1,"h4"),w.Bc(2,"not found"),w.Ob(),w.Ob())}function W(t,e){if(1&t&&(w.Nb(0),w.Pb(1,"app-header-box",1),w.Lb(2,"map",2),w.Ob(),w.zc(3,Q,3,0,"div",3),w.Lb(4,"app-trip-passages-list",4),w.Mb()),2&t){var n=e.ngIf,a=w.cc();w.Ab(1),w.lc("title","",null==n?null:n.tripInfo.routeName," - ",null==n?null:n.tripInfo.directionText,""),w.Ab(1),w.ic("mapData",a.headerMapData),w.Ab(1),w.ic("ngIf",n.status==a.STATUS_OPS.NOT_FOUND),w.Ab(1),w.ic("tripInfo",n.tripInfo)}}var Y,X,Z,tt,et=((X=function(){function t(e,n){i(this,t),this.zone=e,this.passageService=n,this.subscriptions=[],this.STATUS_OPS=D}return o(t,[{key:"ngOnInit",value:function(){var t=this;this.subscriptions.push(this.passageService.createStopLocationObservable().pipe(Object(h.a)(this.zone)).subscribe({next:function(e){t.headerMapData=e?{map:{center:e},stops:void 0,vehicles:[e]}:{map:{blur:!0,center:void 0}}}}))}},{key:"ngOnDestroy",value:function(){this.subscriptions.forEach((function(t){t.unsubscribe()})),this.subscriptions=[]}}]),t}()).\u0275fac=function(t){return new(t||X)(w.Kb(w.z),w.Kb(A))},X.\u0275cmp=w.Eb({type:X,selectors:[["app-trip-passages"]],features:[w.zb([A])],decls:2,vars:3,consts:[[4,"ngIf"],[3,"title"],["appOlStatic","",3,"mapData"],["class","not-found",4,"ngIf"],[3,"tripInfo"],[1,"not-found"]],template:function(t,e){1&t&&(w.zc(0,W,5,5,"ng-container",0),w.dc(1,"async")),2&t&&w.ic("ngIf",w.ec(1,1,e.passageService.statusObservable))},directives:[u.l,N.a,L.a,$],pipes:[u.b],styles:["h3.route-title[_ngcontent-%COMP%]{padding:24px}div.error-box[_ngcontent-%COMP%]{background:#f44336;padding:16px;flex:0 0 auto}div.error-box[_ngcontent-%COMP%]   span.title[_ngcontent-%COMP%]{text-transform:capitalize;font-weight:700;display:block;font-size:16px}div.error-box[_ngcontent-%COMP%]   span.text[_ngcontent-%COMP%]{font-size:12px}mat-nav-list[_ngcontent-%COMP%]{flex-grow:1}"]}),X),nt=((Y=function(){function t(e){i(this,t),this.api=e}return o(t,[{key:"resolve",value:function(t,e){var n=t.params.tripId;return this.api.getTripPassages(n).pipe(E.convertResponse(n),E.handleError(n))}}]),t}()).\u0275fac=function(t){return new(t||Y)(w.Vb(k.a))},Y.\u0275prov=w.Gb({token:Y,factory:Y.\u0275fac}),Y),at=[{component:et,data:{openSidebar:!0},path:":tripId",resolve:{tripPassages:nt}}],st=((tt=function t(){i(this,t)}).\u0275mod=w.Ib({type:tt}),tt.\u0275inj=w.Hb({factory:function(t){return new(t||tt)},imports:[[O.i.forChild(at)],O.i]}),tt),it=((Z=function t(){i(this,t)}).\u0275mod=w.Ib({type:Z}),Z.\u0275inj=w.Hb({factory:function(t){return new(t||Z)},providers:[nt],imports:[[u.c,f.b,l.d,st,b.a,g.b]]}),Z)}}])}();